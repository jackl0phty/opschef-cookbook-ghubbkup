#!/usr/bin/env ruby

# Include required libraries.
require 'optparse'

# Declare variables.
github_user = ''
github_pass = ''

options = {}

opt_parser = OptionParser.new do |opt|
  opt.banner = "Usage: chefknife COMMAND [OPTIONS]"
  opt.separator  ""
  opt.separator  "Commands"
  opt.separator  "     all: Backups ALL Git repos on Github under a single user account."
  opt.separator  ""
  opt.separator  "Options"

  opt.on("-h","--help","help") do
    puts opt_parser
  end
end

opt_parser.parse!

def get_config

  # Declare local variables.
  conf_dir = '/etc/ghubbkup.conf'
  ghubbkup_config = []

  # Read ghubbkup config & get github settings.
  #ghubbkup_config = File.open("#{conf_dir}").map.each do |line|
  #  line.chomp!
  #  line.split('~~')
  #end

  # Loop array & clone ALL Github repos.
  #for config in ghubbkup_config

    # Uncomment lines below to debug.
  #  puts "Github options: #{config}"

  #end

   # Get github user.
  github_user = `cat #{conf_dir} |grep github_user`
  github_user.slice! "github_user~~"

  # Get github password.
  github_pass = `cat #{conf_dir} |grep github_user`
  github_pass.slice! "github_pass~~"

  # Uncomment to debug.
  puts "Github user: #{github_user}"
  puts "Github pass: #{github_pass}"

end

def clone_repos(github_user, github_pass)

  # Uncomment to debug.
  puts "Github user: #{github_user}"
  puts "Github pass: #{github_pass}" 

  # Get repo list.
  Github.repos.list user: "#{github_user}"
  
end

def get_github_creds(github_user, github_pass)

  # Get github user from config.
  github_user = `cat #{conf_dir} |grep github_user`
  github_user.slice! "github_user~~"

  # Get github password.
  github_pass = `cat #{conf_dir} |grep github_user`
  github_pass.slice! "github_pass~~"
 
  # Return Github user.
  return github_user
 
  # Return Github password.
  return github_pass

  # Uncomment to debug.
  puts "Github user: #{github_user}"
  puts "Github pass: #{github_pass}"

end

case ARGV[0]

when "all"

  # Get config options.
  get_config

  # Get Github creds.
  get_github_creds(github_user, github_pass)  

  # Uncomment to debug.
  puts "Github user: #{github_user}"
  puts "Github pass: #{github_pass}"

  # Clone ALL Github repos.
  #clone_repos

else
  puts opt_parser
end
